-- ===== AUTOFARM + KILL AURA NATURAL =====
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")

if not player then return end

-- Remove GUI antiga
pcall(function()
	CoreGui:FindFirstChild("InfoExperienciaGui"):Destroy()
end)

-- ===== GUI =====
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "InfoExperienciaGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = CoreGui

local frame = Instance.new("Frame")
frame.Parent = screenGui
frame.Size = UDim2.new(0, 520, 0, 150)
frame.Position = UDim2.new(0, 40, 0, 40)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.BorderSizePixel = 0
frame.Active = true

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = frame

local textLabel = Instance.new("TextLabel")
textLabel.Parent = frame
textLabel.Size = UDim2.new(1, -20, 1, -20)
textLabel.Position = UDim2.new(0, 10, 0, 10)
textLabel.BackgroundTransparency = 1
textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
textLabel.Font = Enum.Font.SourceSansBold
textLabel.TextWrapped = true
textLabel.TextScaled = true
textLabel.TextXAlignment = Enum.TextXAlignment.Left
textLabel.TextYAlignment = Enum.TextYAlignment.Top

local nomeExperiencia = game.Name
task.spawn(function()
	while frame.Parent do
		textLabel.Text = "Experiência em Teste:\n"..nomeExperiencia.."\n\nData e Hora:\n"..os.date("%d/%m/%Y - %H:%M:%S")
		task.wait(1)
	end
end)

-- Drag GUI
local dragging, dragStart, startPos = false, nil, nil
local UserInputService = game:GetService("UserInputService")

local function update(input)
	local delta = input.Position - dragStart
	frame.Position = UDim2.new(
		startPos.X.Scale,
		startPos.X.Offset + delta.X,
		startPos.Y.Scale,
		startPos.Y.Offset + delta.Y
	)
end

frame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then dragging = false end
		end)
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		update(input)
	end
end)

-- ===== CONFIGURAÇÕES =====
local autofarmEnabled = false
local killAuraEnabled = false
local lockedNPC = nil
local BACK_DISTANCE = 3.5
local HEIGHT_OFFSET = 2.5
local UPDATE_DELAY = 0.2
local MAX_DISTANCE = 60
local KILL_RADIUS = 10
local KILL_DELAY_MIN, KILL_DELAY_MAX = 0.2, 0.45 -- ataque aleatório
local activeNPCs = {}

-- ===== BOTÕES GUI =====
local function createButton(name, posY)
	local btn = Instance.new("TextButton")
	btn.Parent = frame
	btn.Size = UDim2.new(0, 160, 0, 40)
	btn.Position = UDim2.new(1, -170, 1, posY)
	btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 18
	btn.Text = name
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0,8)
	corner.Parent = btn
	return btn
end

local toggleButton = createButton("Autofarm: OFF", -50)
local killButton = createButton("Kill Aura: OFF", -100)

toggleButton.MouseButton1Click:Connect(function()
	autofarmEnabled = not autofarmEnabled
	lockedNPC = nil
	toggleButton.Text = autofarmEnabled and "Autofarm: ON" or "Autofarm: OFF"
	toggleButton.BackgroundColor3 = autofarmEnabled and Color3.fromRGB(0,140,0) or Color3.fromRGB(40,40,40)
end)

killButton.MouseButton1Click:Connect(function()
	killAuraEnabled = not killAuraEnabled
	killButton.Text = killAuraEnabled and "Kill Aura: ON" or "Kill Aura: OFF"
	killButton.BackgroundColor3 = killAuraEnabled and Color3.fromRGB(140,0,0) or Color3.fromRGB(40,40,40)
end)

-- ===== LISTA DE NPCS ATIVOS (1 vez por segundo) =====
task.spawn(function()
	while true do
		local temp = {}
		for _, model in ipairs(workspace:GetDescendants()) do
			if model:IsA("Model") and model:FindFirstChild("Humanoid") and model:FindFirstChild("HumanoidRootPart") and model.Humanoid.Health > 0 then
				table.insert(temp, model)
			end
		end
		activeNPCs = temp
		task.wait(1)
	end
end)

-- ===== FUNÇÕES =====
local function findClosestNPC()
	local character = player.Character
	local root = character and character:FindFirstChild("HumanoidRootPart")
	if not root then return nil end
	local closest, minDist = nil, MAX_DISTANCE
	for _, model in ipairs(activeNPCs) do
		local dist = (root.Position - model.HumanoidRootPart.Position).Magnitude
		if dist < minDist then
			minDist = dist
			closest = model
		end
	end
	return closest
end

-- ===== AUTOFARM ESTÁTICO =====
local lastUpdate = 0
RunService.Heartbeat:Connect(function(dt)
	if not autofarmEnabled then return end
	lastUpdate = lastUpdate + dt
	if lastUpdate < UPDATE_DELAY then return end
	lastUpdate = 0

	local character = player.Character
	local root = character and character:FindFirstChild("HumanoidRootPart")
	if not root then return end

	if not lockedNPC or not lockedNPC.Parent or not lockedNPC:FindFirstChild("Humanoid") or lockedNPC.Humanoid.Health <= 0 then
		lockedNPC = findClosestNPC()
	end

	if lockedNPC and lockedNPC:FindFirstChild("HumanoidRootPart") then
		local npcRoot = lockedNPC.HumanoidRootPart
		local targetPos = npcRoot.Position + (-npcRoot.CFrame.LookVector * BACK_DISTANCE) + Vector3.new(0, HEIGHT_OFFSET,0)
		root.AssemblyLinearVelocity = Vector3.zero
		root.AssemblyAngularVelocity = Vector3.zero
		root.CFrame = CFrame.new(targetPos)
	end
end)

-- ===== KILL AURA “NATURAL” =====
local lastKill = 0
RunService.Heartbeat:Connect(function(dt)
	if not killAuraEnabled then return end
	lastKill = lastKill + dt
	if lastKill < KILL_DELAY_MIN then return end

	local character = player.Character
	local root = character and character:FindFirstChild("HumanoidRootPart")
	if not root then return end

	local targets = {}
	if lockedNPC and lockedNPC:FindFirstChild("HumanoidRootPart") and lockedNPC.Humanoid.Health > 0 then
		table.insert(targets, lockedNPC)
	end
	for _, npc in ipairs(activeNPCs) do
		if npc ~= lockedNPC and (root.Position - npc.HumanoidRootPart.Position).Magnitude <= KILL_RADIUS then
			table.insert(targets, npc)
		end
	end

	for _, npc in ipairs(targets) do
		if npc and npc:FindFirstChild("Humanoid") then
			-- Simula ataque natural com delay aleatório
			local delayTime = math.random()*(KILL_DELAY_MAX-KILL_DELAY_MIN)+KILL_DELAY_MIN
			task.spawn(function()
				task.wait(delayTime)
				if npc.Humanoid and npc.Humanoid.Health > 0 then
					pcall(function()
						npc.Humanoid:TakeDamage(1) -- ajuste conforme seu jogo
					end)
				end
			end)
		end
	end
	lastKi
