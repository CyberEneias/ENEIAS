-- ===== AUTOFARM ULTRA-LEVE + GOD MODE + SPEED + INFINITE JUMP + MACRO M1 =====

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local player = Players.LocalPlayer
if not player then return end

-- ===== CONFIG =====
local CONFIG = {
	BACK_DISTANCE = 3.5,
	HEIGHT_OFFSET = 2.5,
	MAX_DISTANCE = 60,
	UPDATE_INTERVAL = 1,
	GUI_NAME = "InfoExperienciaGui",
	NPC_SCAN_INTERVAL = 0.3
}

-- ===== NPC FOLDER =====
local AliveFolder = workspace:WaitForChild("Alive")

-- ===== CACHE =====
local Vector3_new = Vector3.new
local Vector3_zero = Vector3.zero
local CFrame_new = CFrame.new
local UDim2_new = UDim2.new

-- ===== STATE =====
local state = {
	autofarmEnabled = false,
	infiniteJumpEnabled = false,
	speedEnabled = false,
	godModeEnabled = false,
	macroM1Enabled = false,

	speedValue = 160,
	lockedNPC = nil,
	lastNPCScan = 0,
	npcCache = {},
	connections = {},
	guiVisible = true,
	guiToggleKey = Enum.KeyCode.F1,
}

-- ===== UTILS =====
local function disconnectConnection(name)
	if state.connections[name] then
		state.connections[name]:Disconnect()
		state.connections[name] = nil
	end
end

-- ===== CLEAN GUI =====
local oldGui = CoreGui:FindFirstChild(CONFIG.GUI_NAME)
if oldGui then oldGui:Destroy() end

-- ===== GUI =====
local gui = Instance.new("ScreenGui", CoreGui)
gui.Name = CONFIG.GUI_NAME
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2_new(0, 560, 0, 400)
frame.Position = UDim2_new(0.5, -280, 0.5, -200)
frame.BackgroundColor3 = Color3.fromRGB(35,35,40)
frame.Active = true
frame.Draggable = true
frame.BorderSizePixel = 0

local frameCorner = Instance.new("UICorner", frame)
frameCorner.CornerRadius = UDim.new(0, 12)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2_new(1,0,0,50)
title.BackgroundTransparency = 1
title.Text = "üî• AUTOFARM CONTROLLER"
title.Font = Enum.Font.GothamBold
title.TextSize = 22
title.TextColor3 = Color3.fromRGB(235,235,235)

-- ===== FUN√á√ÉO BOT√ÉO =====
local function createButton(text, y, width)
	width = width or 220
	local b = Instance.new("TextButton", frame)
	b.Size = UDim2_new(0, width, 0, 45)
	b.Position = UDim2_new(0, 20, 0, y)
	b.BackgroundColor3 = Color3.fromRGB(60,80,100)
	b.TextColor3 = Color3.new(1,1,1)
	b.Font = Enum.Font.GothamBold
	b.TextSize = 15
	b.Text = text

	local corner = Instance.new("UICorner", b)
	corner.CornerRadius = UDim.new(0,8)

	b.MouseEnter:Connect(function()
		TweenService:Create(b, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(90,110,130)}):Play()
	end)
	b.MouseLeave:Connect(function()
		TweenService:Create(b, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60,80,100)}):Play()
	end)

	return b
end

-- ===== BOT√ïES =====
local autofarmBtn = createButton("ü§ñ Autofarm: OFF", 60)
local godBtn      = createButton("üõ°Ô∏è God Mode: OFF", 120)
local jumpBtn     = createButton("üöÄ Infinite Jump: OFF", 180)
local speedBtn    = createButton("üí® Speed: OFF", 240)
local macroBtn    = createButton("üñ±Ô∏è Macro M1: OFF (F2)", 300)

-- ===== SPEED BOX =====
local speedBox = Instance.new("TextBox", frame)
speedBox.Size = UDim2_new(0, 100, 0, 35)
speedBox.Position = UDim2_new(1, -130, 0, 245)
speedBox.Text = tostring(state.speedValue)
speedBox.Font = Enum.Font.GothamBold
speedBox.TextSize = 14
speedBox.BackgroundColor3 = Color3.fromRGB(50,70,90)
speedBox.TextColor3 = Color3.new(1,1,1)

-- ===== MACRO M1 LOOP =====
RunService.Heartbeat:Connect(function()
	if state.macroM1Enabled then
		VirtualInputManager:SendMouseButtonEvent(0,0,0,true,game,0)
		task.wait(0.02)
		VirtualInputManager:SendMouseButtonEvent(0,0,0,false,game,0)
	end
end)

-- ===== AUTOFARM LOOP (ORIGINAL) =====
local function autofarmLoop()
	if not state.autofarmEnabled then return end

	local char = player.Character
	local root = char and char:FindFirstChild("HumanoidRootPart")
	if not root then return end

	if not state.lockedNPC or not state.lockedNPC.Parent then
		state.lockedNPC = findClosestNPC()
	end

	local npc = state.lockedNPC
	if not npc then return end

	local npcRoot = npc:FindFirstChild("HumanoidRootPart")
	if not npcRoot then return end

	root.AssemblyLinearVelocity = Vector3_zero
	root.AssemblyAngularVelocity = Vector3_zero

	root.CFrame = CFrame_new(
		npcRoot.Position
		- npcRoot.CFrame.LookVector * CONFIG.BACK_DISTANCE
		+ Vector3_new(0, CONFIG.HEIGHT_OFFSET, 0)
	)
end

-- ===== BUTTON LOGIC =====
autofarmBtn.MouseButton1Click:Connect(function()
	state.autofarmEnabled = not state.autofarmEnabled
	autofarmBtn.Text = state.autofarmEnabled and "ü§ñ Autofarm: ON" or "ü§ñ Autofarm: OFF"

	if state.autofarmEnabled then
		disconnectConnection("autofarm")
		state.connections.autofarm = RunService.Heartbeat:Connect(autofarmLoop)
	else
		disconnectConnection("autofarm")
	end
end)

macroBtn.MouseButton1Click:Connect(function()
	state.macroM1Enabled = not state.macroM1Enabled
	macroBtn.Text = state.macroM1Enabled and "üñ±Ô∏è Macro M1: ON (F2)" or "üñ±Ô∏è Macro M1: OFF (F2)"
end)

-- ===== INPUT =====
UserInputService.InputBegan:Connect(function(input, processed)
	if processed then return end

	if input.KeyCode == Enum.KeyCode.F1 then
		state.guiVisible = not state.guiVisible
		frame.Visible = state.guiVisible
	end

	if input.KeyCode == Enum.KeyCode.F2 then
		state.macroM1Enabled = not state.macroM1Enabled
		macroBtn.Text = state.macroM1Enabled and "üñ±Ô∏è Macro M1: ON (F2)" or "üñ±Ô∏è Macro M1: OFF (F2)"
	end
end)
