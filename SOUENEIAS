-- ===== AUTOFARM + GOD MODE + SPEED + INFINITE JUMP + CLEAN KILL AURA =====

-- ===== SERVICES =====
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
if not player then return end

-- ===== CONFIG =====
local CONFIG = {
	GUI_NAME = "CleanKillAuraGui",

	-- Kill Aura
	DAMAGE = 8,
	STUN = 0.65,
	RANGE = 6,
	SIZE = Vector3.new(6,5,6),
	ATTACK_DELAY = 0.25,

	-- Autofarm
	BACK_DISTANCE = 3.5,
	HEIGHT_OFFSET = 2.5,
	MAX_DISTANCE = 60,
	NPC_SCAN_INTERVAL = 0.3
}

-- ===== FOLDERS / REMOTES =====
local AliveFolder = workspace:WaitForChild("Alive")
local CombatEvent = ReplicatedStorage:WaitForChild("Events"):WaitForChild("CombatEvent")

-- ===== STATE =====
local state = {
	autofarm = false,
	god = false,
	speed = false,
	infiniteJump = false,
	killaura = false,

	speedValue = 160,
	lastAttack = 0,
	npcCache = {},
	lastScan = 0,
	connections = {}
}

-- ===== UTILS =====
local function disconnect(name)
	if state.connections[name] then
		state.connections[name]:Disconnect()
		state.connections[name] = nil
	end
end

-- ===== GUI CLEAN =====
local old = CoreGui:FindFirstChild(CONFIG.GUI_NAME)
if old then old:Destroy() end

-- ===== GUI =====
local gui = Instance.new("ScreenGui", CoreGui)
gui.Name = CONFIG.GUI_NAME
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,420,0,360)
frame.Position = UDim2.new(0.5,-210,0.5,-180)
frame.BackgroundColor3 = Color3.fromRGB(35,35,40)
frame.Active = true
frame.Draggable = true
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,12)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1,0,0,45)
title.BackgroundTransparency = 1
title.Text = "ğŸ”¥ CLEAN COMBAT CONTROLLER"
title.Font = Enum.Font.GothamBold
title.TextSize = 20
title.TextColor3 = Color3.fromRGB(235,235,235)

local function createButton(text,y)
	local b = Instance.new("TextButton", frame)
	b.Size = UDim2.new(0,200,0,42)
	b.Position = UDim2.new(0,20,0,y)
	b.Text = text
	b.Font = Enum.Font.GothamBold
	b.TextSize = 14
	b.TextColor3 = Color3.new(1,1,1)
	b.BackgroundColor3 = Color3.fromRGB(60,80,100)
	Instance.new("UICorner", b).CornerRadius = UDim.new(0,8)
	return b
end

local autofarmBtn = createButton("ğŸ¤– Autofarm: OFF", 60)
local godBtn      = createButton("ğŸ›¡ï¸ God Mode: OFF", 110)
local jumpBtn     = createButton("ğŸš€ Infinite Jump: OFF", 160)
local speedBtn    = createButton("ğŸ’¨ Speed: OFF", 210)
local killauraBtn = createButton("âš”ï¸ Kill Aura: OFF", 260)

-- ===== NPC CACHE =====
local function updateNPCs()
	table.clear(state.npcCache)

	local char = player.Character
	local root = char and char:FindFirstChild("HumanoidRootPart")
	if not root then return end

	for _,npc in ipairs(AliveFolder:GetChildren()) do
		if npc:IsA("Model") and npc ~= char then
			local hum = npc:FindFirstChildOfClass("Humanoid")
			local r = npc:FindFirstChild("HumanoidRootPart")
			if hum and r and hum.Health > 0 then
				local dist = (root.Position - r.Position).Magnitude
				if dist <= CONFIG.MAX_DISTANCE then
					table.insert(state.npcCache,{
						model = npc,
						root = r,
						hum = hum,
						dist = dist
					})
				end
			end
		end
	end

	table.sort(state.npcCache,function(a,b)
		return a.dist < b.dist
	end)
end

local function getClosestNPC()
	if tick() - state.lastScan > CONFIG.NPC_SCAN_INTERVAL then
		updateNPCs()
		state.lastScan = tick()
	end
	return state.npcCache[1]
end

-- ===== AUTOFARM LOOP =====
local function autofarmLoop()
	if not state.autofarm then return end
	local char = player.Character
	local root = char and char:FindFirstChild("HumanoidRootPart")
	if not root then return end

	local npcData = getClosestNPC()
	if not npcData then return end

	root.CFrame =
		npcData.root.CFrame *
		CFrame.new(0, CONFIG.HEIGHT_OFFSET, CONFIG.BACK_DISTANCE)
end

-- ===== CLEAN KILL AURA (RECRIAÃ‡ÃƒO) =====
local function killAuraLoop()
	if not state.killaura then return end
	if tick() - state.lastAttack < CONFIG.ATTACK_DELAY then return end

	local npcData = getClosestNPC()
	if not npcData then return end

	local attackData = {
		HitPart = npcData.root,
		HitPos = npcData.root.Position,
		Damage = CONFIG.DAMAGE,
		Stun = CONFIG.STUN,
		Range = CONFIG.RANGE,
		Size = CONFIG.SIZE,
		AttackType = "M1",
		ComboIndex = 1
	}

	CombatEvent:FireServer(attackData)
	state.lastAttack = tick()
end

-- ===== GOD MODE =====
RunService.Heartbeat:Connect(function()
	if state.god then
		local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
		if hum then
			hum.MaxHealth = math.huge
			hum.Health = hum.MaxHealth
		end
	end
end)

-- ===== SPEED =====
local function speedLoop()
	if not state.speed then return end
	local char = player.Character
	local hum = char and char:FindFirstChildOfClass("Humanoid")
	local root = char and char:FindFirstChild("HumanoidRootPart")
	if hum and root and hum.MoveDirection.Magnitude > 0 then
		root.AssemblyLinearVelocity =
			hum.MoveDirection.Unit * state.speedValue +
			Vector3.new(0, root.AssemblyLinearVelocity.Y, 0)
	end
end

-- ===== BUTTONS =====
autofarmBtn.MouseButton1Click:Connect(function()
	state.autofarm = not state.autofarm
	autofarmBtn.Text = state.autofarm and "ğŸ¤– Autofarm: ON" or "ğŸ¤– Autofarm: OFF"
	disconnect("autofarm")
	if state.autofarm then
		state.connections.autofarm = RunService.Heartbeat:Connect(autofarmLoop)
	end
end)

godBtn.MouseButton1Click:Connect(function()
	state.god = not state.god
	godBtn.Text = state.god and "ğŸ›¡ï¸ God Mode: ON" or "ğŸ›¡ï¸ God Mode: OFF"
end)

jumpBtn.MouseButton1Click:Connect(function()
	state.infiniteJump = not state.infiniteJump
	jumpBtn.Text = state.infiniteJump and "ğŸš€ Infinite Jump: ON" or "ğŸš€ Infinite Jump: OFF"
end)

speedBtn.MouseButton1Click:Connect(function()
	state.speed = not state.speed
	speedBtn.Text = state.speed and "ğŸ’¨ Speed: ON" or "ğŸ’¨ Speed: OFF"
	disconnect("speed")
	if state.speed then
		state.connections.speed = RunService.Heartbeat:Connect(speedLoop)
	end
end)

killauraBtn.MouseButton1Click:Connect(function()
	state.killaura = not state.killaura
	killauraBtn.Text = state.killaura and "âš”ï¸ Kill Aura: ON" or "âš”ï¸ Kill Aura: OFF"
end)

-- ===== INFINITE JUMP =====
UserInputService.JumpRequest:Connect(function()
	if state.infiniteJump then
		local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
		if hum then hum:ChangeState(Enum.HumanoidStateType.Jumping) end
	end
end)

-- ===== MAIN LOOPS =====
RunService.Heartbeat:Connect(killAuraLoop)

