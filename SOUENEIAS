-- ===== AUTOFARM ULTRA-LEVE + GOD MODE + SPEED + INFINITE JUMP =====

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local VirtualUser = game:GetService("VirtualUser")

local player = Players.LocalPlayer
if not player then return end

-- ===== CONFIG =====
local CONFIG = {
	BACK_DISTANCE = 3.5,
	HEIGHT_OFFSET = 2.5,
	MAX_DISTANCE = 60,
	GUI_NAME = "InfoExperienciaGui",
	NPC_SCAN_INTERVAL = 0.3
}

-- ===== NPC FOLDER =====
local AliveFolder = workspace:WaitForChild("Alive")

-- ===== CACHE =====
local Vector3_new = Vector3.new
local Vector3_zero = Vector3.zero
local CFrame_new = CFrame.new
local UDim2_new = UDim2.new

-- ===== STATE =====
local state = {
	autofarmEnabled = false,
	infiniteJumpEnabled = false, -- <<<<<< INFINITE JUMP STATE
	speedEnabled = false,
	godModeEnabled = false,
	macroM1Enabled = false,
	speedValue = 160,
	lockedNPC = nil,
	lastNPCScan = 0,
	npcCache = {},
	connections = {},
	guiVisible = true,
	guiToggleKey = Enum.KeyCode.F1,
}

-- ===== UTILS =====
local function disconnectConnection(name)
	if state.connections[name] then
		state.connections[name]:Disconnect()
		state.connections[name] = nil
	end
end

-- ===== CLEAN GUI =====
local oldGui = CoreGui:FindFirstChild(CONFIG.GUI_NAME)
if oldGui then oldGui:Destroy() end

-- ===== GUI =====
local gui = Instance.new("ScreenGui", CoreGui)
gui.Name = CONFIG.GUI_NAME
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2_new(0, 560, 0, 350)
frame.Position = UDim2_new(0.5, -280, 0.5, -175)
frame.BackgroundColor3 = Color3.fromRGB(35,35,40)
frame.Active = true
frame.Draggable = true
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2_new(1,0,0,50)
title.BackgroundTransparency = 1
title.Text = "üî• AUTOFARM CONTROLLER"
title.Font = Enum.Font.GothamBold
title.TextSize = 22
title.TextColor3 = Color3.fromRGB(235,235,235)

-- ===== BUTTON FACTORY =====
local function createButton(text, y, width)
	width = width or 220
	local b = Instance.new("TextButton", frame)
	b.Size = UDim2_new(0, width, 0, 45)
	b.Position = UDim2_new(0, 20, 0, y)
	b.BackgroundColor3 = Color3.fromRGB(60,80,100)
	b.TextColor3 = Color3.new(1,1,1)
	b.Font = Enum.Font.GothamBold
	b.TextSize = 15
	b.Text = text
	Instance.new("UICorner", b).CornerRadius = UDim.new(0,8)
	return b
end

-- ===== BOT√ïES =====
local autofarmBtn = createButton("ü§ñ Autofarm: OFF", 60)
local macroBtn    = createButton("üñ±Ô∏è Macro M1: OFF", 60, 220)
macroBtn.Position = UDim2_new(0, 260, 0, 60)

local godBtn   = createButton("üõ°Ô∏è God Mode: OFF", 120)
local jumpBtn  = createButton("üöÄ Infinite Jump: OFF", 180) -- <<<<<< BOT√ÉO
local speedBtn = createButton("üí® Speed: OFF", 240)

-- ===== SPEED BOX =====
local speedBox = Instance.new("TextBox", frame)
speedBox.Size = UDim2_new(0, 100, 0, 35)
speedBox.Position = UDim2_new(1, -130, 0, 245)
speedBox.Text = tostring(state.speedValue)
speedBox.Font = Enum.Font.GothamBold
speedBox.TextSize = 14
speedBox.BackgroundColor3 = Color3.fromRGB(50,70,90)
speedBox.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", speedBox).CornerRadius = UDim.new(0,6)

-- ===== AUTOFARM =====
local function autofarmLoop()
	if not state.autofarmEnabled then return end
	local char = player.Character
	local root = char and char:FindFirstChild("HumanoidRootPart")
	if not root then return end

	for _, npc in ipairs(AliveFolder:GetChildren()) do
		local hrp = npc:FindFirstChild("HumanoidRootPart")
		local hum = npc:FindFirstChild("Humanoid")
		if hrp and hum and hum.Health > 0 then
			root.CFrame =
				hrp.CFrame
				- hrp.CFrame.LookVector * CONFIG.BACK_DISTANCE
				+ Vector3_new(0, CONFIG.HEIGHT_OFFSET, 0)
			break
		end
	end
end

-- ===== SPEED =====
local function speedLoop()
	if not state.speedEnabled then return end
	local char = player.Character
	local root = char and char:FindFirstChild("HumanoidRootPart")
	local hum = char and char:FindFirstChildOfClass("Humanoid")
	if root and hum and hum.MoveDirection.Magnitude > 0 then
		root.AssemblyLinearVelocity =
			hum.MoveDirection.Unit * state.speedValue +
			Vector3_new(0, root.AssemblyLinearVelocity.Y, 0)
	end
end

-- ===== MACRO M1 =====
local function macroM1Loop()
	if not state.macroM1Enabled then return end
	VirtualUser:Button1Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
	task.wait(0.05)
	VirtualUser:Button1Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
end

-- ===== INFINITE JUMP (PARTE PRINCIPAL) =====
UserInputService.JumpRequest:Connect(function()
	if state.infiniteJumpEnabled then
		local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
		if hum then
			hum:ChangeState(Enum.HumanoidStateType.Jumping)
		end
	end
end)

-- ===== BOT√ïES =====
autofarmBtn.MouseButton1Click:Connect(function()
	state.autofarmEnabled = not state.autofarmEnabled
	autofarmBtn.Text = state.autofarmEnabled and "ü§ñ Autofarm: ON" or "ü§ñ Autofarm: OFF"
	disconnectConnection("autofarm")
	if state.autofarmEnabled then
		state.connections.autofarm = RunService.Heartbeat:Connect(autofarmLoop)
	end
end)

jumpBtn.MouseButton1Click:Connect(function()
	state.infiniteJumpEnabled = not state.infiniteJumpEnabled
	jumpBtn.Text = state.infiniteJumpEnabled and "üöÄ Infinite Jump: ON" or "üöÄ Infinite Jump: OFF"
end)

speedBtn.MouseButton1Click:Connect(function()
	state.speedEnabled = not state.speedEnabled
	speedBtn.Text = state.speedEnabled and "üí® Speed: ON" or "üí® Speed: OFF"
	state.speedValue = tonumber(speedBox.Text) or state.speedValue
	disconnectConnection("speed")
	if state.speedEnabled then
		state.connections.speed = RunService.Heartbeat:Connect(speedLoop)
	end
end)

macroBtn.MouseButton1Click:Connect(function()
	state.macroM1Enabled = not state.macroM1Enabled
	macroBtn.Text = state.macroM1Enabled and "üñ±Ô∏è Macro M1: ON" or "üñ±Ô∏è Macro M1: OFF"
	disconnectConnection("macroM1")
	if state.macroM1Enabled then
		state.connections.macroM1 = RunService.Heartbeat:Connect(macroM1Loop)
	end
end)

-- ===== TECLAS =====
UserInputService.InputBegan:Connect(function(input, processed)
	if processed then return end

	if input.KeyCode == state.guiToggleKey then
		state.guiVisible = not state.guiVisible
		frame.Visible = state.guiVisible
	end

	if input.KeyCode == Enum.KeyCode.F2 then
		macroBtn:Activate()
	end
end)

